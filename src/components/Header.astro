---
const currentPath = Astro.url.pathname;
console.log(currentPath);

const filters = ["all", "design", "development", "user research"];
---

<script>
  // The key is the filter's 'value' from the checkbox.
  // The value is an array of all the data-category tags it should match.
  const filterAliases = {
    "user research": ["user research", "ux"],
    development: ["development", "web development", "dev", "coding"],
    design: ["design", "web design", "UI", "app design", "branding"],
  };

  const handleOptionChange = (event) => {
    // --- 1. MANAGE CHECKBOX STATES ---
    const allInput = document.querySelector('.filteroption[value="all"]');
    const otherInputs = [
      ...document.querySelectorAll('.filteroption:not([value="all"])'),
    ];
    const clickedInput = event.target;

    // If 'All' was clicked and is now checked, uncheck all other options.
    if (clickedInput.value === "all" && clickedInput.checked) {
      otherInputs.forEach((input) => (input.checked = false));
    }
    // If another option was clicked and is now checked, uncheck 'All'.
    else if (clickedInput.value !== "all" && clickedInput.checked) {
      allInput.checked = false;
    }

    // If no specific filters are checked (e.g., the user unselected the last one),
    // default back to selecting 'All'.
    const anyOtherChecked = otherInputs.some((input) => input.checked);
    if (!anyOtherChecked) {
      allInput.checked = true;
    }

    // --- 2. APPLY THE FILTER LOGIC ---
    // Get the final selection of checked boxes AFTER managing the states above.
    const selection = [
      ...document.querySelectorAll(".filteroption:checked"),
    ].map(($input) => $input.value);

    const allProjects = document.querySelectorAll("[data-category]");
    const noResultsMessage = document.querySelector(".noResults");
    const yearHeadings = document.querySelectorAll(".show-dates");
    const noYearHeadings = document.querySelectorAll(".dont-show-dates");

    // If 'All' is selected, simply show everything and finish.
    if (selection.includes("all")) {
      allProjects.forEach(($li) => $li.classList.remove("hidden"));
      noResultsMessage.classList.add("hidden");
      yearHeadings.forEach(($h) => $h.classList.remove("hidden"));
      noYearHeadings.forEach(($h) => $h.classList.add("hidden"));
      return; // Exit the function early
    }

    // Otherwise, proceed with applying the specific filters.
    yearHeadings.forEach(($h) => $h.classList.add("hidden"));
    noYearHeadings.forEach(($h) => $h.classList.remove("hidden"));
    const expandedSelection = selection.flatMap(
      (filter) => filterAliases[filter] || filter,
    );

    let hasVisibleProjects = false;
    allProjects.forEach(($li) => {
      // Get project categories, and trim whitespace from each just in case.
      const projectCategories = $li.dataset.category
        .split(",")
        .map((cat) => cat.trim());

      // Check if any of the project's categories are in the selected list.
      const shouldBeVisible = projectCategories.some((category) =>
        expandedSelection.includes(category),
      );

      if (shouldBeVisible) {
        $li.classList.remove("hidden");
        hasVisibleProjects = true;
      } else {
        $li.classList.add("hidden");
      }
    });

    // --- 3. SHOW 'NO RESULTS' MESSAGE IF NEEDED ---
    if (hasVisibleProjects) {
      noResultsMessage.classList.add("hidden");
    } else {
      noResultsMessage.classList.remove("hidden");
    }
  };

  // --- 4. INITIAL SETUP ---
  // Wait for the page to load to ensure elements are available.
  document.addEventListener("DOMContentLoaded", () => {
    const allInput = document.querySelector('.filteroption[value="all"]');
    // Set the "All" button to be checked by default on page load.
    if (allInput) {
      allInput.checked = true;
    }
  });

  // Add the event listener to all checkboxes.
  const options = document.querySelectorAll(".filteroption");
  options.forEach((option) =>
    option.addEventListener("click", handleOptionChange),
  );
</script>

<style>
  header {
    position: sticky;
  }

  .nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 1rem;
  }

  .nav__title {
    font-size: var(--fs-3);
    font-style: normal;
    font-weight: 600;
    line-height: normal;
  }

  .nav__title a {
    color: var(--text-color);
    text-decoration: none;
  }

  .nav__list {
    display: flex;
    font-weight: 300;
  }

  .nav__item a {
    color: var(--text-color);
    text-decoration: none;

    border-bottom: 1px solid transparent; /* Initial state */
    border-color: transparent;
    transition: border-color 0.3s ease;
    padding-bottom: 0.1rem;
  }

  .nav__item + .nav__item::before {
    content: "/";
    margin: 0.5rem;
    text-decoration: none;
  }

  .nav__title:hover {
    animation: wiggle 0.5s ease; /* Apply the wiggle animation on hover */
  }

  .nav__item a {
    /* Additional styling */
    position: relative;
    outline: none !important;
    transition: 1.2s;
  }

  .nav__item a::after {
    content: "";
    background-color: black;
    position: absolute;
    bottom: 0;
    left: 0;
    height: 1px;
    width: 0;
    transition: 0.2s;
  }

  .nav__item a:hover::after,
  .nav__item a:focus::after {
    width: 100%;
  }

  .modus__list,
  .filter__list {
    display: flex;
    gap: calc(var(--space-2xs) / 2);
    font-weight: 300;
  }

  .modus__item,
  .filter__item {
    border: 0.75px solid black;
    border-radius: 100px;
    padding: 0 var(--space-2xs);

    text-transform: lowercase;

    transition:
      background-color 0.5s,
      color 0.25s;
  }

  .modus__item a {
    text-decoration: none;
    color: black;
  }

  .modus__item--active,
  .filter__item:has(input:checked) {
    background-color: black;
    color: var(--bg-color);
    font-weight: 400;
  }

  .modus__item:hover a {
    color: var(--bg-color);
  }

  .modus__item:hover {
    background-color: black;
  }

  .filter__item input {
    display: none;
  }

  @keyframes wiggle {
    0% {
      transform: rotate(0deg); /* Start at the original position */
    }
    25% {
      transform: rotate(5deg); /* Rotate a little bit to the right */
    }
    50% {
      transform: rotate(-5deg); /* Rotate a little bit to the left */
    }
    75% {
      transform: rotate(5deg); /* Rotate a little bit to the right */
    }
    100% {
      transform: rotate(0deg); /* End at the original position */
    }
  }

  @media screen and (min-width: 48rem) {
    .nav {
      margin-bottom: var(--space-2xs);
    }

    header {
      top: 0;
      padding: 1rem;
      margin: calc(var(--space-m) - 1rem);
      background-color: (var(--bg-color) / 100%);
      backdrop-filter: blur(20px);
      z-index: 100;

      mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
      -webkit-mask-image: linear-gradient(
        to bottom,
        black 75%,
        transparent 100%
      );
    }
  }
</style>

<header class="container">
  <nav class="nav">
    <h1 class="nav__title"><a href="/">Jana</a></h1>

    {
      currentPath === "/projects" ? (
        <ul class="filter__list">
          {filters.map((filter) => (
            <li class="filter__item">
              <label>
                <span>{filter}</span>
                <input
                  class="filteroption"
                  type="radio"
                  value={filter}
                  name="filter"
                />
              </label>
            </li>
          ))}
        </ul>
      ) : (
        <ul class="modus__list">
          <li class="modus__item modus__item--active">normal</li>
          <li class="modus__item">
            <a href="/discover">discover</a>
          </li>
        </ul>
      )
    }

    <ul class="nav__list" id="nav__list">
      <li class="nav__item"><a href="/projects">projects</a></li>
      <li class="nav__item"><a href="/about">about</a></li>
    </ul>
  </nav>
</header>
